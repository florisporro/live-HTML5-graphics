/*!
 * depd
 * Copyright(c) 2014 Douglas Christopher Wilson
 * MIT Licensed
 *//**
 * Module dependencies.
 */function containsNamespace(e,t){var n=e.split(/[ ,]+/);t=String(t).toLowerCase();for(var r=0;r<n.length;r++){if(!(e=n[r]))continue;if(e==="*"||e.toLowerCase()===t)return!0}return!1}function convertDataDescriptorToAccessor(e,t,n){var r=Object.getOwnPropertyDescriptor(e,t),i=r.value;r.get=function(){return i};r.writable&&(r.set=function(t){return i=t});delete r.value;delete r.writable;Object.defineProperty(e,t,r);return r}function createArgumentsString(e){var t="";for(var n=0;n<e;n++)t+=", arg"+n;return t.substr(2)}function createStackString(e){var t=this.name+": "+this.namespace;this.message&&(t+=" deprecated "+this.message);for(var n=0;n<e.length;n++)t+="\n    at "+callSiteToString(e[n]);return t}function depd(e){function i(e){log.call(i,e)}if(!e)throw new TypeError("argument namespace is required");var t=getStack(),n=callSiteLocation(t[1]),r=n[0];i._file=r;i._ignored=isignored(e);i._namespace=e;i._traced=istraced(e);i._warned=Object.create(null);i.function=wrapfunction;i.property=wrapproperty;return i}function isignored(e){if(process.noDeprecation)return!0;var t=process.env.NO_DEPRECATION||"";return containsNamespace(t,e)}function istraced(e){if(process.traceDeprecation)return!0;var t=process.env.TRACE_DEPRECATION||"";return containsNamespace(t,e)}function log(e,t){var n=eventListenerCount(process,"deprecation")!==0;if(!n&&this._ignored)return;var r,i,s,o=0,u=!1,a=getStack(),f=this._file;if(t){s=callSiteLocation(a[1]);s.name=t.name;f=s[0]}else{o=2;t=callSiteLocation(a[o]);s=t}for(;o<a.length;o++){r=callSiteLocation(a[o]);i=r[0];if(i===f)u=!0;else if(i===this._file)f=this._file;else if(u)break}var l=r?t.join(":")+"__"+r.join(":"):undefined;if(l!==undefined&&l in this._warned)return;this._warned[l]=!0;e||(e=s===t||!s.name?defaultMessage(t):defaultMessage(s));if(n){var c=DeprecationError(this._namespace,e,a.slice(o));process.emit("deprecation",c);return}var h=process.stderr.isTTY?formatColor:formatPlain,p=h.call(this,e,r,a.slice(o));process.stderr.write(p+"\n","utf8");return}function callSiteLocation(e){var t=e.getFileName()||"<anonymous>",n=e.getLineNumber(),r=e.getColumnNumber();e.isEval()&&(t=e.getEvalOrigin()+", "+t);var i=[t,n,r];i.callSite=e;i.name=e.getFunctionName();return i}function defaultMessage(e){var t=e.callSite,n=e.name;n||(n="<anonymous@"+formatLocation(e)+">");var r=t.getThis(),i=r&&t.getTypeName();i==="Object"&&(i=undefined);i==="Function"&&(i=r.name||i);return i&&t.getMethodName()?i+"."+n:n}function formatPlain(e,t,n){var r=(new Date).toUTCString(),i=r+" "+this._namespace+" deprecated "+e;if(this._traced){for(var s=0;s<n.length;s++)i+="\n    at "+callSiteToString(n[s]);return i}t&&(i+=" at "+formatLocation(t));return i}function formatColor(e,t,n){var r="[36;1m"+this._namespace+"[22;39m"+" [33;1mdeprecated[22;39m"+" [0m"+e+"[39m";if(this._traced){for(var i=0;i<n.length;i++)r+="\n    [36mat "+callSiteToString(n[i])+"[39m";return r}t&&(r+=" [36m"+formatLocation(t)+"[39m");return r}function formatLocation(e){return relative(basePath,e[0])+":"+e[1]+":"+e[2]}function getStack(){var e=Error.stackTraceLimit,t={},n=Error.prepareStackTrace;Error.prepareStackTrace=prepareObjectStackTrace;Error.stackTraceLimit=Math.max(10,e);Error.captureStackTrace(t);var r=t.stack.slice(1);Error.prepareStackTrace=n;Error.stackTraceLimit=e;return r}function prepareObjectStackTrace(e,t){return t}function wrapfunction(fn,message){if(typeof fn!="function")throw new TypeError("argument fn must be a function");var args=createArgumentsString(fn.length),deprecate=this,stack=getStack(),site=callSiteLocation(stack[1]);site.name=fn.name;var deprecatedfn=eval("(function ("+args+") {\n"+'"use strict"\n'+"log.call(deprecate, message, site)\n"+"return fn.apply(this, arguments)\n"+"})");return deprecatedfn}function wrapproperty(e,t,n){if(!e||typeof e!="object"&&typeof e!="function")throw new TypeError("argument obj must be object");var r=Object.getOwnPropertyDescriptor(e,t);if(!r)throw new TypeError("must call property on owner object");if(!r.configurable)throw new TypeError("property must be configurable");var i=this,s=getStack(),o=callSiteLocation(s[1]);o.name=t;"value"in r&&(r=convertDataDescriptorToAccessor(e,t,n));var u=r.get,a=r.set;typeof u=="function"&&(r.get=function(){log.call(i,n,o);return u.apply(this,arguments)});typeof a=="function"&&(r.set=function(){log.call(i,n,o);return a.apply(this,arguments)});Object.defineProperty(e,t,r)}function DeprecationError(e,t,n){var r=new Error,i;Object.defineProperty(r,"constructor",{value:DeprecationError});Object.defineProperty(r,"message",{configurable:!0,enumerable:!1,value:t,writable:!0});Object.defineProperty(r,"name",{enumerable:!1,configurable:!0,value:"DeprecationError",writable:!0});Object.defineProperty(r,"namespace",{configurable:!0,enumerable:!1,value:e,writable:!0});Object.defineProperty(r,"stack",{configurable:!0,enumerable:!1,get:function(){return i!==undefined?i:i=createStackString.call(this,n)},set:function(t){i=t}});return r}var callSiteToString=require("./lib/compat").callSiteToString,EventEmitter=require("events").EventEmitter,relative=require("path").relative;module.exports=depd;var basePath=process.cwd(),eventListenerCount=EventEmitter.listenerCount||function(e,t){return e.listeners(t).length};